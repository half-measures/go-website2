<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>

    <h1>{{.Title}}</h1>

    <div class="content">
        <p>{{.Body}}</p>
    </div>
<div style="text-align: center;">
    {{if .YouTubeEmbed}}
        {{range .YouTubeEmbed}}
            <div class="youtube-embed">
                <iframe width="560" height="315" src="{{.URL}}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                <div class="vote-container">
                    <button class="vote-btn" onclick="vote('{{$.Title}}', '{{.ID}}', 'upvote')">▲</button>
                    <span class="vote-count" id="vote-count-{{.ID}}">{{.Votes}}</span>
                    <button class="vote-btn" onclick="vote('{{$.Title}}', '{{.ID}}', 'downvote')">▼</button>
                </div>
            </div>
        {{end}}
    {{end}}
        </div>
    <hr>

    <button onclick="addYouTubeVideo('{{.Title}}')">Add/Update YouTube Video</button>
    <a href="/" class="home-link">[Back to Home]</a>

    <script>
        async function vote(slug, videoID, action) {
            try {
                const response = await fetch(`/api/vote/${slug}/${videoID}/${action}`, {
                    method: 'POST',
                });

                if (response.ok) {
                    // It worked! Reload the page to see the new vote count.
                    window.location.reload();
                } else {
                    // Show an error if something went wrong
                    alert("Error saving vote: " + await response.text());
                }
            } catch (err) {
                console.error('Vote error:', err);
                alert('A network error occurred. Check the console.');
            }
        }

        async function addYouTubeVideo(slug) {
            const url = prompt("Please enter the full YouTube video URL:");

            // User cancelled or entered nothing
            if (url === null || url.trim() === "") {
                return;
            }

            try {
                // The API endpoint is expecting a JSON body
                const response = await fetch(`/api/page/${slug}/save-youtube`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ youtube_url: url }),
                });

                if (response.ok) {
                    // It worked! Reload the page to see the new video.
                    alert("Video link saved!");
                    window.location.reload();
                } else {
                    // Show an error if something went wrong
                    alert("Error saving link: " + await response.text());
                }
            } catch (err) {
                console.error('Save link error:', err);
                alert('A network error occurred. Check the console.');
            }
        }
    </script>

<footer class="minimal-footer">
    <p class="tagline">Because sometimes the trailer is better than the movie.</p>
    <p class="copyright">
        &copy; {{.Year}} TH |
        <a href="https://www.youtube.com/" target="_blank" aria-label="Find us on YouTube">YT ▶️</a>
    </p>
</footer>
</body>
</html>